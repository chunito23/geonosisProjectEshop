<mvc:View
  xmlns:mvc="sap.ui.core.mvc"
  xmlns="sap.m"
  xmlns:core="sap.ui.core"
  xmlns:l="sap.ui.layout"
  xmlns:f="sap.f"
  controllerName="starwarsfrontend.controller.Catalog">

  <Page title="Catálogo">
    <customHeader>
      <Bar>
        <contentMiddle>
          <Title text="Catálogo de Productos" level="H1" titleStyle="H1" />
        </contentMiddle>
      </Bar>
    </customHeader>
    
    <content>
      <List items="{/Categories}">
        <CustomListItem>
          <VBox class="sapUiSmallMargin categoryContainer">
            <Title text="{name}" level="H2" class="categoryTitle" />

            <List items="{subcategories}">
              <CustomListItem>
                <VBox class="sapUiTinyMargin subcategoryContainer">
                  <Title text="{name}" level="H3" class="subcategoryTitle" />

                  <!-- HBox con tarjetas de productos mejoradas -->
                  <FlexBox wrap="Wrap" items="{products}" class="sapUiTinyMarginTop productsContainer">

                    <f:Card 
                      width="280px" 
                      class="sapUiSmallMargin productCard" 
                      press="onProductCardPress">
                      <f:header>
                        <f:CardHeader
                          title="{name}"
                          subtitle="{= ${stock} > 0 ? 'Stock: ' + ${stock} : 'Agotado'}"
                          iconSrc="{= ${stock} > 0 ? 'sap-icon://product' : 'sap-icon://alert'}"
                          iconDisplayShape="Circle"
                          status="{
                            path: 'stock',
                            formatter: '.formatStockStatus'
                          }" />
                      </f:header>
                      <f:content>
                        <VBox>
                          <!-- Imagen del producto -->
                          <Image
                            src="{image}"
                            width="100%"
                            height="180px"
                            mode="Background"
                            backgroundSize="cover"
                            class="productImage" />
                            
                          <!-- Detalles del producto -->
                          <VBox class="sapUiSmallPadding productDetails">
                            <HBox justifyContent="SpaceBetween" alignItems="Center">
                              <ObjectNumber 
                                number="{price}" 
                                unit="{currency}" 
                                class="productPrice" />
                                
                              <ObjectStatus 
                                text="{= ${stock} > 0 ? 'Disponible' : 'Agotado'}" 
                                state="{= ${stock} > 0 ? 'Success' : 'Error'}" />
                            </HBox>
                            
                            <!-- Descripción breve -->
                            <Text text="{description}" maxLines="2" class="sapUiTinyMarginTop productDescription" />
                            
                            <!-- Botones de acción -->
                            <HBox justifyContent="SpaceBetween" class="sapUiSmallMarginTop">
                              <Button
                                text="Añadir"
                                type="Default"
                                icon="sap-icon://cart-3"
                                enabled="{= ${stock} > 0}"
                                press="onAddToCart"
                                class="actionButton" />
                              <Button
                                text="Comprar"
                                type="Emphasized"
                                icon="sap-icon://credit-card"
                                enabled="{= ${stock} > 0}"
                                press="onBuyNow"
                                class="actionButton" />
                            </HBox>
                          </VBox>
                        </VBox>
                      </f:content>
                    </f:Card>
                  </FlexBox>

                </VBox>
              </CustomListItem>
            </List>
          </VBox>
        </CustomListItem>
      </List>
    </content>

    <footer>
      <Bar>
        <contentRight>
          <Button 
            icon="sap-icon://cart" 
            text="Ver Carrito" 
            type="Emphasized" 
            press="onViewCart" />
        </contentRight>
      </Bar>
    </footer>
  </Page>
</mvc:View>